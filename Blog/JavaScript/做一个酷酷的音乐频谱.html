<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>做一个酷酷的音乐频谱 | a&#39;ゞ『完美』</title>
    <meta name="description" content="一颗前端小白菜……">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.6114eb0d.css" as="style"><link rel="preload" href="/assets/js/app.0a35a00c.js" as="script"><link rel="preload" href="/assets/js/2.8fa79959.js" as="script"><link rel="preload" href="/assets/js/7.4ef0c1e6.js" as="script"><link rel="prefetch" href="/assets/js/3.6cdaae9c.js"><link rel="prefetch" href="/assets/js/4.024ee9b8.js"><link rel="prefetch" href="/assets/js/5.e3510cb0.js"><link rel="prefetch" href="/assets/js/6.ff0f212e.js"><link rel="prefetch" href="/assets/js/8.c111b603.js"><link rel="prefetch" href="/assets/js/9.6613c730.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6114eb0d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">a'ゞ『完美』</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://node.zxycc.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  音乐
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/Blog/JavaScript/" class="nav-link router-link-active">JavaScript</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://node.zxycc.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  音乐
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/Blog/JavaScript/" class="nav-link router-link-active">JavaScript</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Blog/JavaScript/做一个酷酷的音乐频谱.html" class="active sidebar-link">做一个酷酷的音乐频谱</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/JavaScript/做一个酷酷的音乐频谱.html#先上个demo" class="sidebar-link">先上个demo</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/做一个酷酷的音乐频谱.html#audioapi的基本概念" class="sidebar-link">AudioAPI的基本概念</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/做一个酷酷的音乐频谱.html#通过html-media元素流式加载" class="sidebar-link">通过HTML Media元素流式加载</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/做一个酷酷的音乐频谱.html#最后有一个3d版的带搜索功能的demo" class="sidebar-link">最后有一个3D版的带搜索功能的Demo</a></li></ul></li><li><a href="/Blog/JavaScript/CreateJs入门必知必会.html" class="sidebar-link">CreateJs入门必知必会</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#createjs介绍" class="sidebar-link">CreateJS介绍</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#学习-createjs-第一步，先要看文档" class="sidebar-link">学习 CreateJs 第一步，先要看文档</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#createjs-部分-api-简单说明" class="sidebar-link">CreateJs 部分 API 简单说明</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#createjs做动画效果" class="sidebar-link">CreateJs做动画效果</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#createjs-给元素添加事件" class="sidebar-link">CreateJs 给元素添加事件</a></li><li class="sidebar-sub-header"><a href="/Blog/JavaScript/CreateJs入门必知必会.html#最后附上几个我之前做的demo。代码略渣" class="sidebar-link">最后附上几个我之前做的demo。代码略渣</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="做一个酷酷的音乐频谱"><a href="#做一个酷酷的音乐频谱" class="header-anchor">#</a> 做一个酷酷的音乐频谱</h1> <h2 id="先上个demo"><a href="#先上个demo" class="header-anchor">#</a> 先上个demo</h2> <p><a href="http://zxycc.cc/demo/music/" target="_blank" rel="noopener noreferrer">音乐频谱<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="/images/2017052301370954.png" alt=""></p> <h2 id="audioapi的基本概念"><a href="#audioapi的基本概念" class="header-anchor">#</a> AudioAPI的基本概念</h2> <p>H5的Web Audio API可以很方便的使用（虽然各家浏览器实现的标准都不太一样）各种音频功能，比如可以用麦克风录制声音然后生成音频文件，还可以对声源定位，做那种3D音效，混音等等，听过3D音效的都知道，声音一会左，一会右的，还支持实时的声音分析，根据分析的数据可以做一些可视化效果等等。
其中AudioContext是Web Audio API的基石,AudioContext对象可以“线性”处理字节流。</p> <div class="custom-block tip"><p class="custom-block-title">这个线性的意思就是用Web Audio的信号传递途径</p> <p>1.首先要建立音频的前后境况<br>
2.在境况内设定音频的输入源<br>
3.加入各种音响效果<br>
4.设定音频的输出终点<br>
5.将音频的输入，效果，输出终点连接起来<br></p></div> <p>如图</p> <img src="/images/2017052014163853.png"><br> <p>AudioAPI的大部分操作都是通过一个个连接的节点完成的，这些节点需要连通，从声源节点到输出节点都必须保持通畅才能正常工作。就像在电路上连接一个个元件来完成不同的工作，最后连接到扬声器上。</p> <p>最简单的路线就是从声源直接连接到输出节点：source → destination</p> <p>输出节点在AudioContext实例的destination上可以找到，而声源节点却有很多。</p> <p>MediaElementSource、MediaStreamSource、BufferSource、Oscillator、createScriptProcessor</p> <p>这些都是声源节点。它们都是可以产生波，并传输给下一个节点的。所以要让AudioAPI发出声音，最简单的代码可以这么写：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> AudioContext <span class="token operator">=</span> AudioContext<span class="token operator">||</span>webkitAudioContext<span class="token punctuation">;</span>
<span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> oscillator <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">createOscillator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
oscillator<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
oscillator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>直接从声源连接到输出节点是最简单的用法，AudioAPI还提供了很多节点用于对音频的特殊处理。</p> <p>比如Gain节点用来调整音量、BiquadFilter节点用来过滤一些数据。当数据从这些节点上流过时就会被做相应的处理。</p> <p>这些节点的连接也不是一对一那么简单的，它可能一对多，比如一个声源头可以同时给多个节点处理，之后再把这些中间节点汇总起来，这就要关心这些节点的分支与汇总的问题了。</p> <p>总之，AudioAPI的设计就像是电路设计，有机地组合它所提供的节点就可以完成几乎所有音频处理。</p> <h2 id="通过html-media元素流式加载"><a href="#通过html-media元素流式加载" class="header-anchor">#</a> 通过HTML Media元素流式加载</h2> <p>使用<mark>audio</mark>元素流式加载音乐文件, 在JavaScript中调用createMediaElementSource方法, 直接操作HTMLMediaElement。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--
	写一个audio标签，给一个音乐地址
	地址必须是本地音乐，不能使用跨域的音乐资源
	运行代码还必须是服务器环境，不然没效果，因为跨域限制
	加上controls（显示控制面板） autoplay（自动播放） loop（循环播放）这3个属性
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>audio</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audio<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>1.mp3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoplay</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>autoplay<span class="token punctuation">&quot;</span></span> <span class="token attr-name">loop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>loop<span class="token punctuation">&quot;</span></span> <span class="token attr-name">controls</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>controls<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>audio</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>现在audio标签可以用来播放音乐了。</p> <p>创建canvas画布</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#canvas</span> <span class="token punctuation">{</span>
	<span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
	<span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
	<span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
	<span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>
	<span class="token property">background</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>编写js脚本</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> audio <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;audio&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建境况</span>
<span class="token keyword">var</span> AudioContext <span class="token operator">=</span> window<span class="token punctuation">.</span>AudioContext <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitAudioContext<span class="token punctuation">;</span>
<span class="token keyword">var</span> audioContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建输入源</span>
<span class="token keyword">var</span> source <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createMediaElementSource</span><span class="token punctuation">(</span>audio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 用createAnalyser方法,获取音频时间和频率数据,实现数据可视化。</span>
<span class="token keyword">var</span> analyser <span class="token operator">=</span> audioContext<span class="token punctuation">.</span><span class="token function">createAnalyser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 连接：source → analyser → destination</span>
source<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>analyser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 声音连接到扬声器</span>
analyser<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>audioContext<span class="token punctuation">.</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 存储频谱数据，Uint8Array数组创建的时候必须制定长度，
长度就从analyser.frequencyBinCount里面获取，长度是1024*/</span>
<span class="token keyword">var</span> arrData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>analyser<span class="token punctuation">.</span>frequencyBinCount<span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token comment">// 能量柱个数,不能大于数组长度1024,没意义</span>
count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span>arrData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token comment">/* 计算步长，每隔多少取一个数据用于绘画，意抽取片段数据来反映整体频谱规律，
	乘以0.6是因为，我测试发现数组长度600以后的数据基本都是0了，
	画出来能量柱高度就是0了，为了效果好一点，所以只取前60%，
	如果为了真实可以不乘以0.6
*/</span>
step <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>arrData<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">0.6</span> <span class="token operator">/</span> count<span class="token punctuation">)</span><span class="token punctuation">,</span>
value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//每个能量柱的值</span>
drawX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//能量柱X轴位置</span>
drawY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//能量柱Y轴坐标</span>
height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span><span class="token comment">//canvas高度</span>
width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span><span class="token comment">//canvas宽度</span>
<span class="token comment">// 能量柱宽度，设置线条宽度</span>
lineWidth <span class="token operator">=</span> context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> count<span class="token punctuation">;</span>
<span class="token comment">// 设置线条宽度</span>
context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth<span class="token punctuation">;</span>
<span class="token comment">// 渲染函数</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//每次要清除画布</span>
	context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//获取频谱值</span>
	analyser<span class="token punctuation">.</span><span class="token function">getByteFrequencyData</span><span class="token punctuation">(</span>arrData<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//前面已经计算好步长了</span>
		value <span class="token operator">=</span> arrData<span class="token punctuation">[</span>i <span class="token operator">*</span> step <span class="token operator">+</span> step<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token comment">//X轴位置计算</span>
		drawX <span class="token operator">=</span> i <span class="token operator">*</span> lineWidth<span class="token punctuation">;</span>
		<span class="token comment">/*  能量柱的高度，从canvas的底部往上画，那么Y轴坐标就是画布的高度减去能量柱的高度，
			而且经测试发现value正常一般都比较小，要画的能量柱高一点，所以就乘以2，
			又防止太高，取了一下最大值，并且canvas里面尽量避免小数值，取整一下
		*/</span>
		drawY <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span>height <span class="token operator">-</span> value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//开始一条路径</span>
		context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/* 设置画笔颜色，hsl通过这个公式出来的是很漂亮的彩虹色
		   H：Hue(色调)。0(或360)表示红色，120表示绿色，240表示蓝色，也可取其他数值来指定颜色。取值为：0 - 360
		   S：Saturation(饱和度)。取值为：0.0% - 100.0%
		   L：Lightness(亮度)。取值为：0.0% - 100.0%
		 */</span>
		context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;hsl( &quot;</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">/</span> count<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, 100%, 50%)&quot;</span><span class="token punctuation">;</span>
		<span class="token comment">// 从X轴drawX，Y轴就是canvas的高度，也就是canvas的底部</span>
		context<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>drawX<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 从X轴drawX，Y轴就是计算好的Y轴，是从下往上画，这么理解</span>
		context<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>drawX<span class="token punctuation">,</span> drawY<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/* stroke方法才是真正的绘制方法,顺便也相当于结束了这次的绘画路径，
			就不用调用closePath方法了
		*/</span>
		context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 用requestAnimationFrame做动画</span>
	<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//调用render函数</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//自适应处理</span>
<span class="token keyword">function</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
	width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
	<span class="token comment">// 能量柱宽度,设置线条宽度</span>
	context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span>resize<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h2 id="最后有一个3d版的带搜索功能的demo"><a href="#最后有一个3d版的带搜索功能的demo" class="header-anchor">#</a> 最后有一个3D版的带搜索功能的Demo</h2> <p><a href="https://node.zxycc.cc/" target="_blank" rel="noopener noreferrer">音乐频谱（手动点击页面，自动播放，点击打开歌曲列表，支持回车搜索）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Blog/JavaScript/CreateJs入门必知必会.html">CreateJs入门必知必会</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0a35a00c.js" defer></script><script src="/assets/js/2.8fa79959.js" defer></script><script src="/assets/js/7.4ef0c1e6.js" defer></script>
  </body>
</html>
